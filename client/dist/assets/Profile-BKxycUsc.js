import{d as z,j as e,N as J,r as m,L as Q}from"./index-yNFFM0-c.js";const y="https://beydecks-production.up.railway.app/api";function _(){var D;const{isAuthenticated:R,user:a,logout:B}=z();if(!R||!a)return e.jsx(J,{to:"/user-auth"});const[d,j]=m.useState({blade:"",ratchet:"",bit:"",notes:""}),[h,N]=m.useState({blade:"",ratchet:"",bit:"",notes:""}),[C,P]=m.useState("win"),[b,w]=m.useState(1),v=5,[Y,S]=m.useState(0),[i,T]=m.useState(((D=a.matchupHistory)==null?void 0:D.filter(t=>t==null?void 0:t.id))??[]),[o,p]=m.useState({storeName:"",date:"",totalPlayers:0,roundWins:0,roundLosses:0,placement:"DNQ"}),[c,k]=m.useState(a.tournamentsPlayed||[]),[x,F]=m.useState(1),f=5,W=async t=>{t.preventDefault();const r=localStorage.getItem("token");if(!r)return;const u=await fetch(`${y}/auth/submit-matchup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({myCombo:d,opponentCombo:h,result:C})});if(u.ok){const{matchup:l}=await u.json(),s=[l,...i];T(s),a.matchupHistory=s,j({blade:"",ratchet:"",bit:"",notes:""}),N({blade:"",ratchet:"",bit:"",notes:""})}else alert("Failed to submit matchup")},$=async t=>{const r=localStorage.getItem("token");if(r)try{if((await fetch(`${y}/auth/tournament/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).ok){const l=c.filter((n,g)=>g!==t);k(l),a.tournamentsPlayed=l;const s={firsts:0,seconds:0,thirds:0,topCutCount:0};for(const n of l)n.placement==="First Place"&&s.firsts++,n.placement==="Second Place"&&s.seconds++,n.placement==="Third Place"&&s.thirds++,["First Place","Second Place","Third Place","Top Cut"].includes(n.placement)&&s.topCutCount++;a.firsts=s.firsts,a.seconds=s.seconds,a.thirds=s.thirds,a.topCutCount=s.topCutCount,S(n=>n+1)}else alert("Failed to delete tournament")}catch(u){console.error(u),alert("Failed to delete tournament")}},L=i.filter(t=>t.result==="win").length,O=i.filter(t=>t.result==="loss").length,E=i.length>0?(L/i.length*100).toFixed(1):"0",A=c.filter(t=>t.placement==="First Place").length,I=c.filter(t=>t.placement==="Second Place").length,M=c.filter(t=>t.placement==="Third Place").length,H=c.filter(t=>["First Place","Second Place","Third Place","Top Cut"].includes(t.placement)).length;return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6 text-white",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-1",children:["Welcome: ",a.username,"!"]}),e.jsx("button",{onClick:B,className:"ml-4 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"logout"})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Your Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-300",children:[e.jsxs("p",{children:["Total Tournaments Played: ",c.length]}),e.jsxs("p",{children:["Top Cut Placements: ",H]}),e.jsxs("p",{children:["🥇 1st Place Finishes: ",A]}),e.jsxs("p",{children:["🥈 2nd Place Finishes: ",I]}),e.jsxs("p",{children:["🥉 3rd Place Finishes: ",M]}),e.jsxs("p",{children:["Matchups Submitted: ",i.length]}),e.jsxs("p",{children:["Wins: ",L," | Losses: ",O]}),e.jsxs("p",{children:["Win Rate: ",E,"%"]})]}),e.jsxs("div",{className:"bg-base-200 mt-4 p-4 rounded text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-1",children:"🔬 Try Tournament Lab"}),e.jsx("p",{className:"text-sm text-neutral-content mb-3",children:"Curious how your combo would perform in real events? Test it against actual tournament data to see how often it appears in top cut results."}),e.jsx("a",{href:"/tournament-lab",className:"btn btn-accent btn-sm inline-flex",children:"Launch Tournament Lab"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Submit Matchup"}),e.jsxs("form",{onSubmit:W,className:"space-y-3 bg-gray-900 p-4 rounded",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Your Combo"}),e.jsx("input",{className:"input",placeholder:"Blade",value:d.blade,onChange:t=>j({...d,blade:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Ratchet",value:d.ratchet,onChange:t=>j({...d,ratchet:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Bit",value:d.bit,onChange:t=>j({...d,bit:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Notes",value:d.notes,onChange:t=>j({...d,notes:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Opponent Combo"}),e.jsx("input",{className:"input",placeholder:"Blade",value:h.blade,onChange:t=>N({...h,blade:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Ratchet",value:h.ratchet,onChange:t=>N({...h,ratchet:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Bit",value:h.bit,onChange:t=>N({...h,bit:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Notes",value:h.notes,onChange:t=>N({...h,notes:t.target.value})})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:C==="win",onChange:()=>P("win")}),e.jsx("span",{className:"ml-1",children:"Win"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:C==="loss",onChange:()=>P("loss")}),e.jsx("span",{className:"ml-1",children:"Loss"})]})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 text-white rounded hover:bg-blue-700",children:"Submit Matchup"})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Submit Tournament"}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const r=localStorage.getItem("token"),u=await fetch(`${y}/auth/submit-tournament`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({userId:a.id,...o})});if(u.ok){let l;try{l=await u.json(),console.log("New tournament response:",l)}catch{console.error("Failed to parse JSON from server"),alert("Server returned invalid response");return}l.date&&(l.date=new Date(l.date).toISOString());const s=[l,...c];k(s),a.tournamentsPlayed=s;const n={firsts:0,seconds:0,thirds:0,topCutCount:0};for(const g of s)g.placement==="First Place"&&n.firsts++,g.placement==="Second Place"&&n.seconds++,g.placement==="Third Place"&&n.thirds++,["First Place","Second Place","Third Place","Top Cut"].includes(g.placement)&&n.topCutCount++;a.firsts=n.firsts,a.seconds=n.seconds,a.thirds=n.thirds,a.topCutCount=n.topCutCount,p({storeName:"",date:"",totalPlayers:0,roundWins:0,roundLosses:0,placement:"DNQ"})}else alert("Failed to submit tournament")},className:"space-y-3 bg-gray-900 p-4 rounded",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Store Name",e.jsx("input",{className:"input",placeholder:"Store Name",value:o.storeName,onChange:t=>p({...o,storeName:t.target.value})})]}),e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Date",e.jsx("input",{type:"date",className:"input",value:o.date,onChange:t=>p({...o,date:t.target.value})})]}),e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Total Players",e.jsx("input",{type:"number",min:0,className:"input",placeholder:"Total Players",value:o.totalPlayers,onChange:t=>p({...o,totalPlayers:+t.target.value})})]}),e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Round Wins",e.jsx("input",{type:"number",min:0,className:"input",placeholder:"Round Wins",value:o.roundWins,onChange:t=>p({...o,roundWins:+t.target.value})})]}),e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Round Losses",e.jsx("input",{type:"number",min:0,className:"input",placeholder:"Round Losses",value:o.roundLosses,onChange:t=>p({...o,roundLosses:+t.target.value})})]}),e.jsxs("label",{className:"text-sm text-white flex flex-col",children:["Placement",e.jsxs("select",{className:"input",value:o.placement,onChange:t=>p({...o,placement:t.target.value}),children:[e.jsx("option",{children:"First Place"}),e.jsx("option",{children:"Second Place"}),e.jsx("option",{children:"Third Place"}),e.jsx("option",{children:"Top Cut"}),e.jsx("option",{children:"DNQ"})]})]})]}),e.jsx("button",{type:"submit",className:"bg-green-600 px-4 py-2 text-white rounded hover:bg-green-700",children:"Submit Tournament"})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Matchup History"}),e.jsx(Q,{to:"/profile/matchup-stats",className:"text-sm bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:"View Data"})]}),i.length===0?e.jsx("p",{className:"text-gray-500",children:"No matchups submitted yet."}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:i.slice((b-1)*v,b*v).map(t=>e.jsxs("li",{className:"bg-gray-800 p-4 rounded shadow text-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:"Your Combo"}),e.jsxs("p",{children:["Blade: ",t.myCombo.blade]}),e.jsxs("p",{children:["Ratchet: ",t.myCombo.ratchet]}),e.jsxs("p",{children:["Bit: ",t.myCombo.bit]}),t.myCombo.notes&&e.jsxs("p",{children:["Notes: ",t.myCombo.notes]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:"Opponent Combo"}),e.jsxs("p",{children:["Blade: ",t.opponentCombo.blade]}),e.jsxs("p",{children:["Ratchet: ",t.opponentCombo.ratchet]}),e.jsxs("p",{children:["Bit: ",t.opponentCombo.bit]}),t.opponentCombo.notes&&e.jsxs("p",{children:["Notes: ",t.opponentCombo.notes]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("span",{className:`font-semibold ${t.result==="win"?"text-green-400":"text-red-400"}`,children:t.result.toUpperCase()}),e.jsx("button",{onClick:async()=>{const r=localStorage.getItem("token");if((await fetch(`${y}/auth/matchup/${t.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).ok){const l=i.filter(s=>s.id!==t.id);T(l),a.matchupHistory=l,S(s=>s+1)}else alert("Failed to delete matchup")},className:"text-sm text-red-500 hover:text-red-700",children:"Delete"})]})]},t.id))}),e.jsxs("div",{className:"flex justify-center mt-4 gap-2",children:[e.jsx("button",{disabled:b===1,onClick:()=>w(b-1),className:"px-3 py-1 bg-gray-700 rounded text-white disabled:opacity-30",children:"Prev"}),e.jsx("button",{disabled:b*v>=i.length,onClick:()=>w(b+1),className:"px-3 py-1 bg-gray-700 rounded text-white disabled:opacity-30",children:"Next"})]})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tournament History"}),c.length===0?e.jsx("p",{className:"text-gray-500",children:"No tournaments submitted yet."}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:c.slice((x-1)*f,x*f).map((t,r)=>e.jsxs("li",{className:"bg-gray-800 p-4 rounded shadow text-gray-200",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"🏪 Store:"})," ",t.storeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"📅 Date:"})," ",new Date(t.date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"👥 Total Players:"})," ",t.totalPlayers]}),e.jsxs("p",{children:[e.jsx("strong",{children:"🆖 Record:"})," ",t.roundWins," Wins / ",t.roundLosses," Losses"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"🏫 Placement:"})," ",t.placement]}),e.jsx("button",{type:"button",onClick:()=>$((x-1)*f+r),className:"text-sm text-red-500 hover:text-red-700 mt-2",children:"Delete"})]},r))}),e.jsxs("div",{className:"flex justify-center mt-4 gap-2",children:[e.jsx("button",{disabled:x===1,onClick:()=>F(x-1),className:"px-3 py-1 bg-gray-700 rounded text-white disabled:opacity-30",children:"Prev"}),e.jsx("button",{disabled:x*f>=c.length,onClick:()=>F(x+1),className:"px-3 py-1 bg-gray-700 rounded text-white disabled:opacity-30",children:"Next"})]})]})]})]})}export{_ as default};
