import{d as C,u as P,r as n,j as e}from"./index-yNFFM0-c.js";const l="https://beydecks-production.up.railway.app/api";function E(){const{login:N}=C(),m=P(),[s,g]=n.useState(!0),[r,p]=n.useState(""),[d,x]=n.useState(""),[b,f]=n.useState(""),[w,o]=n.useState(""),[y,h]=n.useState(""),[u,c]=n.useState(null);n.useEffect(()=>{if(!r){c(null);return}const t=setTimeout(async()=>{try{const a=await fetch(`${l}/auth/user/${encodeURIComponent(r)}`);if(a.ok){const i=await a.json();c(i)}else c(null)}catch{c(null)}},300);return()=>clearTimeout(t)},[r]);const v=async t=>{if(t.preventDefault(),o(""),h(""),s)try{const a=await fetch(`${l}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:d})}),i=await a.json();if(!a.ok)return o(i.error||"Login failed");const j=i.token,S=u&&u.username?{...u,tournamentsPlayed:u.tournamentsPlayed??[],matchupHistory:u.matchupHistory??[]}:await fetch(`${l}/auth/me`,{headers:{Authorization:`Bearer ${j}`}}).then(k=>k.json());N(j,S),m("/profile")}catch{o("Something went wrong.")}else try{const a=await fetch(`${l}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:b,email:r,password:d})}),i=await a.json();if(!a.ok){o(i.error||"Registration failed");return}h("âœ… Registered successfully! You can now log in."),f(""),p(""),x(""),g(!0)}catch{o("Something went wrong during registration.")}};return e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-zinc-900 rounded shadow text-white",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:s?"User Login":"Create an Account"}),e.jsxs("form",{onSubmit:v,className:"flex flex-col gap-4",children:[!s&&e.jsx("input",{className:"border p-2 rounded bg-black text-white",placeholder:"Username",value:b,onChange:t=>f(t.target.value),required:!0}),e.jsx("input",{type:"email",className:"border p-2 rounded bg-black text-white",placeholder:"Email",value:r,onChange:t=>p(t.target.value),required:!0}),e.jsx("input",{type:"password",className:"border p-2 rounded bg-black text-white",placeholder:"Password",value:d,onChange:t=>x(t.target.value),required:!0}),s&&e.jsx("p",{className:"text-right text-sm",children:e.jsx("button",{type:"button",onClick:()=>m("/forgot-password"),className:"text-blue-400 hover:text-blue-600 underline",children:"Forgot Password?"})}),w&&e.jsx("p",{className:"text-red-400",children:w}),y&&e.jsx("p",{className:"text-green-400",children:y}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:s?"Login":"Register"})]}),e.jsxs("p",{className:"mt-4 text-center text-sm text-gray-400",children:[s?"Don't have an account?":"Already have an account?"," ",e.jsx("button",{className:"underline text-blue-400 hover:text-blue-600",onClick:()=>{g(!s),o(""),h("")},children:s?"Register here":"Login here"})]})]})}export{E as default};
